# うまピタ

## これは何
ウマ娘のゲームウィンドウを画面にフィットさせるやつ。
使い方は何となく察してください。

## インストール方法
https://github.com/AoiMoe/umapita/releases から umapita-YYYYMMDD-NN.zip みたいな名前の zip ファイルを落とすと、
中に umapita.exe と umapita_keyhook.dll というファイルが入っているので、これを適当なところに置いて起動してください。
インストーラはありません。

## 注意事項
- 最近の Windows では他のプロセスのウィンドウを操作するのに何かしらの権限が必要なので、
  実行すると UAC の権限昇格ダイアログが出ます。
  （出ないようにするには署名したりしないといけないので、それなりにお金もかかるし面倒くさい）
- 領域を「外枠」にしたときに左右と下に少し隙間があるように見えますが、これは仕様です。
  見えない枠がそこに存在しています（マウスカーソルを持っていってみるとわかります）。
- 最小化ボタンを押すとタスクバーから消えますが、タスクバーの通知領域に「UMPT」という感じのアイコンがあるはずなので、
  それをクリックしてみてください。
- ゲームウィンドウ上でALT+数字（プロファイル切り替えのショートカットキー）が押されたことを検出するために SetWindowsHookEx を使っています。
  SetWindowsHookEx に抵抗があるなら umapita_keyhook.dll を削除すれば無効になります（無くてもそれ以外の機能は動くようになっています）。

## ビルド方法
ビルド環境は msys2 専用。
ただし、TCHAR およびキーフックの都合により、mingw の 32bit アプリケーションとしてコンパイルする必要があります。
つまり msys2 ネイティブな gcc ではなく `mingw-w64-i686-gcc` をインストールする必要があります。
- コンパイル確認しているバージョンは `mingw32/mingw-w64-i686-gcc` の 12.1.0-3
- `/mingw32/bin` にパスが通っている必要があります
  - msys2 ネイティブな gcc のあるディレクトリ(`/usr/bin`)よりも前で指定されている必要があります。
  - スタートメニューの「MSYS2 MinGW x86」で起動した bash を使えば自動的に満たされてるはずです。

## キーフックについて
技術的な話なので、ただ使うだけならこのセクションは気にしなくて良いです。

DMM 版ウマ娘は 64bit exe なのですが、何らかの理由で DLL インジェクションができないようで、64bit アプリケーションからの SetWindowsHookEx ができません。

一方で、Windows には 32bit exe と 64bit exe との間で SetWindowsHookEx をできるようにするための仕組みがあるようで、これが使用される場合には DLL インジェクションを使わずにシステムが SetWindowsHookEx の挙動をエミュレーションするようです。こちらのほうは DMM 版ウマ娘で使えます。

うまピタが 32bit アプリケーションなのはこれが理由です。


## TODO
- ダイアログの数値入力を改善する
- ドキュメント
- 使い方デモ
